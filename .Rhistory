data <- read.csv("SP500_Log_Returns_20150101_20160101.csv")
data <- read.csv("SP500_Log_Returns_20150101_20160101.csv")
head(data)
summary(data)
Xn <- data[[5]]
Xn <- data[[4]]
<- data[[4]]
Returns <- data[[4]]
Returns <- as.numeric(data[[4]])
Returns <- as.numeric(data[[4]])
head(Returns)
View(data)
View(data)
data <- read.csv("SP500_Log_Returns_20150101_20160101.csv")
head(data)
Returns <- as.numeric(data[[4]])
Returns <- data[[4]]
plot(data[[1]], Returns)
plot(data[[1]], Returns, type = 'l')
plot(data[[1]], Returns, type = 'o')
plot(Returns)
plot(Returns, type = 'l')
hist(Returns, breaks = 30)
Xn_bar <- mean(Returns)
Return_var <- var(Returns)
V <- 1e6
Return_mean <- mean(Returns)
Return_var <- var(Returns)
V <- 1e6
alpha <- 0.95
beta <- 0.025
norm_inverse <- qnorm((1-alpha), mean= 0, sd=1)
L_t = -V*(1 - exp(Return_mean +Return_var* norm_inverse))
n <- len(Returns) # number of observations
n <- length(Returns) # number of observations
?dchisq
chisq_up_quant <- beta/2
chisq_down_quant <- 1-beta/2
sigma_up <- ((n-1)*Return_var)/qchisq(p = chisq_up_quant, df = n)
chisq_up_quant <- beta/2
chisq_down_quant <- 1-beta/2
chisq_df <- n-1
sigma_up <- ((n-1)*Return_var)/qchisq(p = chisq_up_quant, df = chisq_df)
sigma_down <- ((n-1)*Return_var)/qchisq(p = chisq_down_quant, df = chisq_df)
# Homework 5 Part 2
# Read data and look at summary statistics
data <- read.csv("SP500_Log_Returns_20150101_20160101.csv")
head(data)
Returns <- data[[4]]
plot(Returns, type = 'l')
hist(Returns, breaks = 30)
# Initialize parameters
V <- 1e6
alpha <- 0.95
beta <- 0.025
numb_sim <- 100000 # M
n <- length(Returns) # number of observations
# Part a
Return_mean <- mean(Returns)
Return_var <- var(Returns)
norm_inverse <- qnorm((1-alpha), mean= 0, sd=1)
VaR_alpha = -V*(1 - exp(Return_mean +sqrt(Return_var)* norm_inverse))
# Use slide 27 equations for upper and lower sigma paramter
chisq_up_quant <- beta/2
chisq_down_quant <- 1-beta/2
chisq_df <- n-1
sigma_up <- ((n-1)*Return_var)/qchisq(p = chisq_up_quant, df = chisq_df)
sigma_down <- ((n-1)*Return_var)/qchisq(p = chisq_down_quant, df = chisq_df)
Var_up <- -V*(1 - exp(Return_mean +sqrt(sigma_up)* norm_inverse))
Var_down <- -V*(1 - exp(Return_mean +sqrt(sigma_down)* norm_inverse))
chisq <- rchisq(numb_sim, chisq_df)
mu_MC <- rnorm(1,mean = Return_mean, sd = sigma_MC)
chisq_MC <- rchisq(numb_sim, chisq_df)
sigma2_MC <- ((n-1)*Return_var)/(chisq_MC)
sigma_MC <- sqrt(sigma2_MC)
# Simulate returns
mu_MC <- rnorm(1,mean = Return_mean, sd = sigma_MC)
?rnorm
# Simulate returns
for(sim in 1:numb_sim){
mu_MC <- rnorm(1,mean = Return_mean, sd = (sigma_MC[sim]/sqrt(n))
}
# Simulate returns
for(sim in 1:numb_sim){
mu_MC <- rnorm(1,mean = Return_mean, sd = (sigma_MC[sim]/sqrt(n)))
}
# Homework 5 Part 2
# Read data and look at summary statistics
data <- read.csv("SP500_Log_Returns_20150101_20160101.csv")
head(data)
Returns <- data[[4]]
plot(Returns, type = 'l')
hist(Returns, breaks = 30)
# Initialize parameters
V <- 1e6
alpha <- 0.95
beta <- 0.025
numb_sim <- 100000 # M
n <- length(Returns) # number of observations
# Part a
Return_mean <- mean(Returns)
Return_var <- var(Returns)
norm_inverse <- qnorm((1-alpha), mean= 0, sd=1)
VaR_alpha = -V*(1 - exp(Return_mean +sqrt(Return_var)* norm_inverse))
# Use slide 27 equations for upper and lower sigma paramter
chisq_up_quant <- beta/2
chisq_down_quant <- 1-beta/2
chisq_df <- n-1
sigma_up <- ((n-1)*Return_var)/qchisq(p = chisq_up_quant, df = chisq_df)
sigma_down <- ((n-1)*Return_var)/qchisq(p = chisq_down_quant, df = chisq_df)
# Watch the signs?
Var_up <- -V*(1 - exp(Return_mean +sqrt(sigma_up)* norm_inverse))
Var_down <- -V*(1 - exp(Return_mean +sqrt(sigma_down)* norm_inverse))
############################################
############# Part b ########################
###########################################
# Following steps on slide 31
# First simulate sigma
chisq_MC <- rchisq(numb_sim, chisq_df)
sigma2_MC <- ((n-1)*Return_var)/(chisq_MC)
sigma_MC <- sqrt(sigma2_MC)
# Simulate mean of the VaR
for(sim in 1:numb_sim){
mu_MC <- rnorm(1,mean = Return_mean, sd = (sigma_MC[sim]/sqrt(n)))
}
# Simulate VaR alpha
VaR_alpha = -V*(1 - exp(mu_MC +sigma_MC* norm_inverse))
VaR_alpha_MC = -V*(1 - exp(mu_MC +sigma_MC* norm_inverse))
hist(VaR_alpha_MC, breaks = 40)
mean(VaR_alpha_MC)
?quantile
quantile(VaR_alpha_MC,c((beta/2),(1-beta/2))
)
VaR_MC_quantiles <- quantile(VaR_alpha_MC,c((beta/2),(1-beta/2)))
# Homework 5 Part 2
# Read data and look at summary statistics
data <- read.csv("SP500_Log_Returns_20150101_20160101.csv")
head(data)
Returns <- data[[4]]
plot(Returns, type = 'l')
hist(Returns, breaks = 30)
# Initialize parameters
V <- 1e6
alpha <- 0.95
beta <- 0.025
numb_sim <- 100000 # M
n <- length(Returns) # number of observations
# Part a
Return_mean <- mean(Returns)
Return_var <- var(Returns)
norm_inverse <- qnorm((1-alpha), mean= 0, sd=1)
VaR_alpha = -V*(1 - exp(Return_mean +sqrt(Return_var)* norm_inverse))
# Use slide 27 equations for upper and lower sigma paramter
conf_int_quantile__down<- beta/2
conf_int_quantile_up <- 1-beta/2
chisq_df <- n-1
sigma_up <- ((n-1)*Return_var)/qchisq(p = conf_int_quantile_up , df = chisq_df)
sigma_down <- ((n-1)*Return_var)/qchisq(p = conf_int_quantile_down, df = chisq_df)
# Watch the signs?
Var_up <- -V*(1 - exp(Return_mean +sqrt(sigma_up)* norm_inverse))
Var_down <- -V*(1 - exp(Return_mean +sqrt(sigma_down)* norm_inverse))
############################################
############# Part b ########################
###########################################
# Following steps on slide 31
# First simulate sigma
chisq_MC <- rchisq(numb_sim, chisq_df)
sigma2_MC <- ((n-1)*Return_var)/(chisq_MC)
sigma_MC <- sqrt(sigma2_MC)
# Simulate mean of the VaR
for(sim in 1:numb_sim){
mu_MC <- rnorm(1,mean = Return_mean, sd = (sigma_MC[sim]/sqrt(n)))
}
# Simulate VaR alpha
VaR_alpha_MC = -V*(1 - exp(mu_MC +sigma_MC* norm_inverse))
hist(VaR_alpha_MC, breaks = 40)
VaR_MC_mean <- mean(VaR_alpha_MC)
VaR_MC_conf_int <- quantile(VaR_alpha_MC,c((beta/2),(1-beta/2)))
VaR_alpha = -V*(1 - exp(Return_mean +sqrt(Return_var)* norm_inverse))
# Use slide 27 equations for upper and lower sigma paramter
conf_int_quantile_down<- beta/2
conf_int_quantile_up <- 1-beta/2
chisq_df <- n-1
sigma_up <- ((n-1)*Return_var)/qchisq(p = conf_int_quantile_up , df = chisq_df)
sigma_down <- ((n-1)*Return_var)/qchisq(p = conf_int_quantile_down, df = chisq_df)
# Watch the signs?
Var_up <- -V*(1 - exp(Return_mean +sqrt(sigma_up)* norm_inverse))
Var_down <- -V*(1 - exp(Return_mean +sqrt(sigma_down)* norm_inverse))
############################################
############# Part b ########################
###########################################
# Following steps on slide 31
# First simulate sigma
chisq_MC <- rchisq(numb_sim, chisq_df)
sigma2_MC <- ((n-1)*Return_var)/(chisq_MC)
sigma_MC <- sqrt(sigma2_MC)
# Simulate mean of the VaR
for(sim in 1:numb_sim){
mu_MC <- rnorm(1,mean = Return_mean, sd = (sigma_MC[sim]/sqrt(n)))
}
# Simulate VaR alpha
VaR_alpha_MC = -V*(1 - exp(mu_MC +sigma_MC* norm_inverse))
hist(VaR_alpha_MC, breaks = 40)
VaR_MC_mean <- mean(VaR_alpha_MC)
VaR_MC_conf_int <- quantile(VaR_alpha_MC,c((beta/2),(1-beta/2)))
conf_ints <- c(conf_int_quantile_down, conf_int_quantile_up)
chisq_df <- n-1
sigmas_known <- ((n-1)*Return_var)/qchisq(p = conf_ints , df = chisq_df)
Var_up <- -V*(1 - exp(Return_mean +sqrt(sigmas_known)* norm_inverse))
Var_up
VaR_MC_conf_int <- quantile(VaR_alpha_MC,conf_ints)
VaR_known = -V*(1 - exp(Return_mean +sqrt(Return_var)* norm_inverse))
Var_known = -V*(1 - exp(Return_mean +sqrt(Return_var)* norm_inverse))
Var_know_conf_int
Var_known_conf_int <- -V*(1 - exp(Return_mean +sqrt(sigmas_known)* norm_inverse))
# Homework 5 Part 2
# Read data and look at summary statistics
data <- read.csv("SP500_Log_Returns_20150101_20160101.csv")
head(data)
Returns <- data[[4]]
plot(Returns, type = 'l')
hist(Returns, breaks = 30)
# Initialize parameters
V <- 1e6
alpha <- 0.95
beta <- 0.025
numb_sim <- 100000 # M
n <- length(Returns) # number of observations
# Part a
Return_mean <- mean(Returns)
Return_var <- var(Returns)
norm_inverse <- qnorm((1-alpha), mean= 0, sd=1)
Var_known = -V*(1 - exp(Return_mean +sqrt(Return_var)* norm_inverse))
# Use slide 27 equations for upper and lower sigma paramter
conf_int_quantile_down<- beta/2
conf_int_quantile_up <- 1-beta/2
conf_ints <- c(conf_int_quantile_down, conf_int_quantile_up)
chisq_df <- n-1
sigmas_known <- ((n-1)*Return_var)/qchisq(p = conf_ints , df = chisq_df)
#sigma_down <- ((n-1)*Return_var)/qchisq(p = conf_int_quantile_down, df = chisq_df)
# Watch the signs?
Var_known_conf_int <- -V*(1 - exp(Return_mean +sqrt(sigmas_known)* norm_inverse))
# Var_down <- -V*(1 - exp(Return_mean +sqrt(sigma_down)* norm_inverse))
############################################
############# Part b ########################
###########################################
# Following steps on slide 31
# First simulate sigma
chisq_MC <- rchisq(numb_sim, chisq_df)
sigma2_MC <- ((n-1)*Return_var)/(chisq_MC)
sigma_MC <- sqrt(sigma2_MC)
# Simulate mean of the VaR
for(sim in 1:numb_sim){
mu_MC <- rnorm(1,mean = Return_mean, sd = (sigma_MC[sim]/sqrt(n)))
}
# Simulate VaR alpha
VaR_alpha_MC = -V*(1 - exp(mu_MC +sigma_MC* norm_inverse))
hist(VaR_alpha_MC, breaks = 40)
VaR_MC_mean <- mean(VaR_alpha_MC)
VaR_MC_conf_int <- quantile(VaR_alpha_MC,conf_ints)
# Compare
Var_known
Var_known_conf_int
VaR_MC_mean
VaR_MC_conf_int
diff(Var_known_conf_int)
diff(VaR_MC_conf_int)
x <- seq(from= -19000, to = -12000, by = 1)
sigmas_known
sum(sigmas_known)/2
y_MC <- dnorm(x, mean = VaR_MC_mean, sd = sd(VaR_alpha_MC))
plot(x,y_known)
x <- seq(from= -19000, to = -12000, by = 1)
# Parameters for part a
# Not sure how to pick the standard deviation....
sd_known_mean <- mean(sqrt(sigmas_known))
y_known <- dnorm(x, mean = Var_known, sd=sd_known_mean )
# For MC calculations
y_MC <- dnorm(x, mean = VaR_MC_mean, sd = sd(VaR_alpha_MC))
plot(x,y_known)
y_known <- rnorm(1000, mean = Var_known, sd=sd_known_mean )
plot(x,y_known)
y_known <- rnorm(length(x), mean = Var_known, sd=sd_known_mean )
# For MC calculations
y_MC <- dnorm(x, mean = VaR_MC_mean, sd = sd(VaR_alpha_MC))
plot(x,y_known)
plot(y_known)
Var_known
sd_known_mean <- mean(sqrt(sigmas_known))
y_known <- dnorm(x, mean = Var_known, sd=sd_known_mean )
plot(y_known)
y_known
y_known <- dnorm(15700, mean = Var_known, sd=sd_known_mean )
y_known
y_known <- dnorm(-15700, mean = Var_known, sd=sd_known_mean )
y_known
y_known <- dnorm(VaR_known, mean = Var_known, sd=sd_known_mean )
y_known <- dnorm(Var_known, mean = Var_known, sd=sd_known_mean )
y_known
y_known <- rnorm(10000, mean = Var_known, sd=sd_known_mean )
summary(y_known)
sd(VaR_alpha_MC)
hist(rchisq(100000,df = (n-1)))
dchisq((beta/2) , df = chisq_df)
qchisq((beta/2) , df = chisq_df)
qchisq((1-beta/2) , df = chisq_df)
qchisq((beta) , df = chisq_df)
abline(v = (beta/2))
abline(v = qchisq((beta/2) , df = chisq_df))
abline(v = qchisq((1-beta/2) , df = chisq_df))
sd(rchisq(1000000, df = chisq_df))
chisq1 <- qchisq((beta/2) , df = chisq_df)
chisq2 <- qchisq((1-beta/2) , df = chisq_df)
chisq_avg <- (chisq1+chisq2)/2
sd_known_mean <- sqrt (((n-1)*Return_var)/chisq_avg)
y_known <- rnorm(10000, mean = Var_known, sd=sd_known_mean )
y_known <- dnorm(x, mean = Var_known, sd=sd_known_mean )
sd_known_mean <- sqrt (((n-1)*Return_var)/chisq_avg)
# Homework 5 Part 2
# Read data and look at summary statistics
data <- read.csv("SP500_Log_Returns_20150101_20160101.csv")
head(data)
Returns <- data[[4]]
plot(Returns, type = 'l')
hist(Returns, breaks = 30)
# Initialize parameters
V <- 1e6
alpha <- 0.95
beta <- 0.025
numb_sim <- 100000 # M
n <- length(Returns) # number of observations
# Part a
Return_mean <- mean(Returns)
Return_var <- var(Returns)
norm_inverse <- qnorm((1-alpha), mean= 0, sd=1)
Var_known = -V*(1 - exp(Return_mean +sqrt(Return_var)* norm_inverse))
# Use slide 27 equations for upper and lower sigma paramter
conf_int_quantile_down<- beta/2
conf_int_quantile_up <- 1-beta/2
conf_ints <- c(conf_int_quantile_down, conf_int_quantile_up)
chisq_df <- n-1
sigmas2_known <- ((n-1)*Return_var)/qchisq(p = conf_ints , df = chisq_df)
#sigma_down <- ((n-1)*Return_var)/qchisq(p = conf_int_quantile_down, df = chisq_df)
# Watch the signs?
Var_known_conf_int <- -V*(1 - exp(Return_mean +sqrt(sigmas2_known)* norm_inverse))
# Var_down <- -V*(1 - exp(Return_mean +sqrt(sigma_down)* norm_inverse))
############################################
############# Part b ########################
###########################################
# Following steps on slide 31
# First simulate sigma
chisq_MC <- rchisq(numb_sim, chisq_df)
sigma2_MC <- ((n-1)*Return_var)/(chisq_MC)
sigma_MC <- sqrt(sigma2_MC)
# Simulate mean of the VaR
for(sim in 1:numb_sim){
mu_MC <- rnorm(1,mean = Return_mean, sd = (sigma_MC[sim]/sqrt(n)))
}
# Simulate VaR alpha
VaR_alpha_MC = -V*(1 - exp(mu_MC +sigma_MC* norm_inverse))
hist(VaR_alpha_MC, breaks = 40)
VaR_MC_mean <- mean(VaR_alpha_MC)
VaR_MC_conf_int <- quantile(VaR_alpha_MC,conf_ints)
# Compare two method of finding VaR
Var_known
Var_known_conf_int
VaR_MC_mean
VaR_MC_conf_int
# The two methods are very similar. The means are slightly differeny but the confidence intervals overlap for the majority of the time.
